<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skrunks Image Repo</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        .image-card {
            transition: all 0.3s ease;
        }
        
        .image-card:hover {
            transform: translateY(-2px);
        }

        .download-overlay {
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .image-card:hover .download-overlay {
            opacity: 1;
        }

        .progress-bar {
            transition: width 0.3s ease;
        }

        .resolution-btn {
            transition: all 0.2s ease;
        }

        .resolution-btn:hover {
            transform: translateY(-1px);
        }

        .header {
            backdrop-filter: blur(8px);
        }

        body {
            background: linear-gradient(to bottom right, #f3e8ff, #e0f2fe);
            min-height: 100vh;
        }
    </style>
</head>
<body>
    <!-- Progress Bar -->
    <div id="progress-container" class="fixed top-0 left-0 w-full h-1 bg-gray-200 z-50">
        <div id="progress-bar" class="h-full bg-blue-500 progress-bar" style="width: 0%"></div>
    </div>

    <!-- Header -->
    <div class="fixed top-0 left-0 right-0 bg-white bg-opacity-80 shadow-md z-40 header">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <h1 class="text-2xl font-bold text-gray-800">
                    üì∏ Skrunks Image Repo
                </h1>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mx-auto px-4 pt-24 pb-12">
        <!-- Loading State -->
        <div id="loading" class="flex flex-col items-center justify-center min-h-[60vh] gap-4">
            <div class="animate-spin rounded-full h-12 w-12 border-4 border-blue-500 border-t-transparent"></div>
            <p class="text-gray-600">Loading your images...</p>
        </div>

        <!-- Resolution Navigation -->
        <div id="resolution-nav" class="mb-8 flex flex-wrap gap-2 hidden"></div>

        <!-- Image Grid -->
        <div id="image-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 hidden"></div>
    </div>

    <script>
        const username = 'alopez5301';
        const repo = 'AF';
        const branch = 'main';

        function getRawGitHubUrl(path) {
            return `https://raw.githubusercontent.com/${username}/${repo}/${branch}/${path}`;
        }

        function updateProgress(percentage) {
            document.getElementById('progress-bar').style.width = `${percentage}%`;
        }

        async function loadImage(url) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => resolve({ width: img.width, height: img.height });
                img.onerror = () => resolve(null);
                img.src = url;
            });
        }

        async function loadImagesInBatches(images, batchSize = 10) {
            const results = new Map();
            for (let i = 0; i < images.length; i += batchSize) {
                const batch = images.slice(i, i + batchSize);
                const promises = batch.map(file => {
                    const url = getRawGitHubUrl(file.path);
                    return loadImage(url).then(dimensions => {
                        if (dimensions) {
                            const resolution = `${dimensions.width}x${dimensions.height}`;
                            if (!results.has(resolution)) {
                                results.set(resolution, []);
                            }
                            results.get(resolution).push({
                                path: file.path,
                                resolution: resolution
                            });
                        }
                    });
                });
                await Promise.all(promises);
                updateProgress(Math.min(((i + batchSize) / images.length) * 100, 100));
            }
            return results;
        }

        function createImageCard(image) {
            return `
                <div class="bg-white rounded-lg shadow-md overflow-hidden image-card">
                    <div class="p-3">
                        <div class="relative aspect-square">
                            <img
                                src="${getRawGitHubUrl(image.path)}"
                                alt="${image.path.split('/').pop()}"
                                class="w-full h-full object-cover rounded-md"
                            />
                            <div class="download-overlay absolute inset-0 bg-black bg-opacity-60 flex items-center justify-center rounded-md">
                                <a
                                    href="${getRawGitHubUrl(image.path)}"
                                    download="${image.path.split('/').pop()}"
                                    class="flex items-center gap-2 bg-white px-4 py-2 rounded-full text-sm font-medium hover:bg-gray-100 transition-colors"
                                >
                                    ‚¨áÔ∏è Download
                                </a>
                            </div>
                        </div>
                        <p class="mt-2 text-sm text-gray-600 truncate text-center">
                            ${image.path.split('/').pop()}
                        </p>
                    </div>
                </div>
            `;
        }

        function showResolution(resolutionGroups, resolution) {
            const imageGrid = document.getElementById('image-grid');
            imageGrid.innerHTML = '';
            
            const images = resolutionGroups.get(resolution);
            images.forEach(image => {
                const cardHtml = createImageCard(image);
                const container = document.createElement('div');
                container.innerHTML = cardHtml;
                imageGrid.appendChild(container.firstChild);
            });

            // Update active resolution button
            document.querySelectorAll('.resolution-btn').forEach(btn => {
                if (btn.textContent === resolution) {
                    btn.classList.add('bg-blue-500', 'text-white', 'shadow-md');
                    btn.classList.remove('bg-white', 'text-gray-600', 'hover:bg-gray-100');
                } else {
                    btn.classList.remove('bg-blue-500', 'text-white', 'shadow-md');
                    btn.classList.add('bg-white', 'text-gray-600', 'hover:bg-gray-100');
                }
            });
        }

        async function initGallery() {
            try {
                const response = await fetch(`https://api.github.com/repos/${username}/${repo}/git/trees/${branch}?recursive=1`);
                const data = await response.json();
                
                const imageFiles = data.tree
                    .filter(file => file.path.startsWith('images/') && 
                            /\.(jpg|jpeg|png|bmp)$/i.test(file.path));

                const resolutionGroups = await loadImagesInBatches(imageFiles);

                // Hide loading state
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('resolution-nav').classList.remove('hidden');
                document.getElementById('image-grid').classList.remove('hidden');

                // Sort resolutions
                const resolutions = Array.from(resolutionGroups.keys())
                    .sort((a, b) => {
                        const [aWidth, aHeight] = a.split('x').map(Number);
                        const [bWidth, bHeight] = b.split('x').map(Number);
                        return (aWidth * aHeight) - (bWidth * bHeight);
                    });

                // Create resolution buttons
                const navContainer = document.getElementById('resolution-nav');
                resolutions.forEach(resolution => {
                    const button = document.createElement('button');
                    button.textContent = resolution;
                    button.className = 'resolution-btn px-4 py-2 rounded-full text-sm font-medium bg-white text-gray-600 hover:bg-gray-100';
                    button.onclick = () => showResolution(resolutionGroups, resolution);
                    navContainer.appendChild(button);
                });

                // Show first resolution
                if (resolutions.length > 0) {
                    showResolution(resolutionGroups, resolutions[0]);
                }

            } catch (error) {
                console.error('Error fetching repository contents:', error);
                document.getElementById('loading').innerHTML = 
                    '<p class="text-red-500">Error loading images. Please check the console for details.</p>';
            }
        }

        initGallery();
    </script>
</body>
</html>
